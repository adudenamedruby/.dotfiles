"$schema" = "https://jj-vcs.github.io/jj/latest/config-schema.json"

[ui]
paginate = "never"
default-command = "log"

[user]
name = "roux g. buciu"
email = "github@adudenamedruby.com"

[git]
push-new-bookmarks = true

[templates]
git_push_bookmark = '"rgb/" ++ change_id.short()'

[aliases]
tug = ["bookmark", "move", "--from", "closest_bookmark(@)", "--to", "closest_pushable(@)"]
pushNewBranch = [
  "util", "exec", "--", "bash", "-euo", "pipefail", "-c", """
  remote="origin"
  ticket=""

  # Parse args
  while [[ $# -gt 0 ]]; do
    case "$1" in
      -r|--remote)
        remote="$2"; shift 2 ;;
      -t|--ticket)
        ticket="$2"; shift 2 ;;
      --ticket=*)
        ticket="${1#*=}"; shift 1 ;;
      -h|--help)
        echo "Available commands:" ;
        echo "-r --remote Specify a remote to push to" ;
        echo "-t --ticket Specify a ticket number to add to branch name" ;
        exit 1 ;;
      *)
        echo "Unknown argument: $1" >&2
        exit 1 ;;
    esac
  done

  base="$(~/.local/myScripts/jj-random-branch)"
  if [[ -n "$ticket" ]]; then
    name="rgb/${ticket}-${base}"
  else
    name="rgb/${base}"
  fi

  set --  # clear args so nothing leaks into jj git push
  exec jj git push --remote "$remote" --named "${name}=@"
  """, "pushnew"
]

[revset-aliases]
'closest_bookmark(to)' = 'heads(::to & bookmarks())'
'closest_pushable(to)' = 'heads(::to & mutable() & ~description(exact:"") & (~empty() | merges()))'
